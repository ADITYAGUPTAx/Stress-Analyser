<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stress Analyzer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #d4fc79, #96e6a1, #a1c4fd, #c2e9fb);
      background-size: 400% 400%;
      animation: gradientBG 20s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      max-width: 600px;
      width: 90%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
    }

    h1 {
      font-weight: 700;
      margin-bottom: 20px;
    }

    .question {
      display: none;
      margin: 20px 0;
    }

    .active {
      display: block;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }

    input[type="number"], select {
      width: 80%;
      padding: 10px;
      margin: 15px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    .slider {
      width: 100%;
      margin: 20px 0;
    }

    .emoji-scale {
      display: flex;
      justify-content: space-between;
      font-size: 1.5em;
    }

    button {
      background: #333;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      font-size: 1em;
      margin-top: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #555; }

    #result {
      margin-top: 30px;
      font-size: 1.2em;
      font-weight: 500;
      display: none;
      animation: fadeIn 1s ease;
    }
    #result span {
      font-size: 2.5em;
      display: block;
      margin-bottom: 10px;
    }

    #quote {
      margin-top: 20px;
      font-style: italic;
      color: #555;
      display: none;
      animation: fadeIn 2s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Stress Analyzer</h1>
    <form id="quizForm">
      <!-- Gender -->
      <div class="question active" data-name="Gender">
        <h3>Select your Gender</h3>
        <select>
          <option value="" disabled selected>Choose</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <button type="button" onclick="nextQuestion()">Next</button>
      </div>

      <!-- Age -->
      <div class="question" data-name="Age">
        <h3>Enter your Age</h3>
        <input type="number" min="10" max="100" placeholder="Your age">
        <button type="button" onclick="nextQuestion()">Next</button>
      </div>

      <!-- Sliders for rest -->
      {% for q in questions if q not in ["Gender", "Age"] %}
      <div class="question" data-name="{{q}}">
        <h3>{{q}}</h3>
        <div class="emoji-scale">
          <span>üòÑ</span><span>üôÇ</span><span>üòê</span><span>üòü</span><span>üò¢</span>
        </div>
        <input type="range" min="1" max="5" value="3" class="slider">
        <button type="button" onclick="nextQuestion()">Next</button>
      </div>
      {% endfor %}

      <div class="question" id="final">
        <button type="submit">Analyze Stress</button>
      </div>
    </form>

    <div id="result"></div>
    <div id="quote"></div>
  </div>

  <!-- Background music -->
  <audio id="bgMusic" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_10f4c8eeb0.mp3" type="audio/mpeg">
  </audio>

  <script>
    const questions = document.querySelectorAll('.question');
    let current = 0;
    let answers = {};

    const quotes = [
      "Calm mind brings inner strength. ‚Äì Dalai Lama",
      "You don‚Äôt have to control your thoughts. You just have to stop letting them control you.",
      "Tension is who you think you should be. Relaxation is who you are.",
      "Do not anticipate trouble, or worry about what may never happen. Keep in the sunlight. ‚Äì Benjamin Franklin",
      "Every day brings a new chance to reset and refocus."
    ];

    function nextQuestion() {
      const q = questions[current];
      const name = q.getAttribute('data-name');
      const input = q.querySelector('input, select');
      if (input) answers[name] = input.value;

      q.classList.remove('active');
      current++;
      if (current < questions.length) {
        questions[current].classList.add('active');
      }
    }

    document.getElementById("quizForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      // Play music here (user action ensures autoplay works)
      const music = document.getElementById("bgMusic");
      music.volume = 0.4;
      music.play().catch(()=>{});

      const res = await fetch("/predict", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({answers})
      });
      const data = await res.json();

      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerHTML = `
        <span>${data.emoji}</span>
        <div style="color:${data.color}">${data.prediction}</div>
      `;

      // Show random quote
      const quoteText = quotes[Math.floor(Math.random() * quotes.length)];
      const quoteEl = document.getElementById("quote");
      quoteEl.innerText = quoteText;
      quoteEl.style.display = "block";
    });
  </script>
</body>
</html>
